<div class="profile-container">
    <!-- Profile Header Section -->
    <div class="profile-header">
      <div class="profile-info">
        <div class="profile-picture-container">
          <div class="profile-picture-wrapper">
            <img [src]="user.profilePicture || 'assets/images/default-avatar.png'" alt="Profile Picture" class="profile-picture">
            <div class="edit-picture-icon" (click)="openProfilePictureSelector()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20h9"></path>
                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
              </svg>
            </div>
          </div>
          <input type="file" #profilePictureInput accept="image/*" (change)="onProfilePictureSelected($event)" style="display: none">
        </div>
        <div class="profile-details">
          <h2>{{ user.fullName }}</h2>
          <p class="user-role-badge" [ngClass]="{ 
            'role-user': user.role === 'USER',
            'role-organizer': user.role === 'ORGANIZER',
            'role-admin': user.role === 'ADMIN'
          }">{{ user.role }}</p>
          <div class="email-verification" *ngIf="!user.isUserVerified">
            <p class="verification-text">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
                <path d="M12 16v-4"></path>
                <path d="M12 8h.01"></path>
              </svg>
              Email not verified
            </p>
            <button class="verify-email-btn" (click)="sendVerificationEmail()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 2L11 13"></path>
                <path d="M22 2l-7 20-4-9-9-4 20-7z"></path>
              </svg>
              Send Verification Code
            </button>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Profile Navigation -->
    <div class="profile-nav">
      <button class="nav-btn" [ngClass]="{'active': activeTab === 'personal'}" (click)="setActiveTab('personal')">Personal Details</button>
      <button class="nav-btn" [ngClass]="{'active': activeTab === 'tickets'}" (click)="setActiveTab('tickets')">My Tickets</button>
      <button class="nav-btn" [ngClass]="{'active': activeTab === 'bids'}" (click)="setActiveTab('bids')">My Bids</button>
      <button class="nav-btn" [ngClass]="{'active': activeTab === 'security'}" (click)="setActiveTab('security')">Security</button>
      
      <!-- Organizer specific tabs -->
      <button *ngIf="user.role === 'ORGANIZER'" class="nav-btn" [ngClass]="{'active': activeTab === 'dashboard'}" (click)="setActiveTab('dashboard')">Dashboard</button>
      <button *ngIf="user.role === 'ORGANIZER'" class="nav-btn" [ngClass]="{'active': activeTab === 'events'}" (click)="setActiveTab('events')">My Events</button>
      
      <!-- Admin specific tabs -->
      <button *ngIf="user.role === 'ADMIN'" class="nav-btn" [ngClass]="{'active': activeTab === 'requests'}" (click)="setActiveTab('requests')">User Requests</button>
      <button *ngIf="user.role === 'ADMIN'" class="nav-btn" [ngClass]="{'active': activeTab === 'tickets-review'}" (click)="setActiveTab('tickets-review')">Ticket Reviews</button>
    </div>
  
    <!-- Profile Content Area -->
    <div class="profile-content">
      <!-- Personal Details Tab -->
      <div *ngIf="activeTab === 'personal'" class="personal-details tab-content">
        <h3>Personal Information</h3>
        <form [formGroup]="personalInfoForm" (ngSubmit)="updatePersonalInfo()">
          <div class="form-row">
            <div class="form-group">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" formControlName="fullName" placeholder="Enter your full name">
              <div class="error-message" *ngIf="personalInfoForm.get('fullName')?.errors && personalInfoForm.get('fullName')?.touched">
                <span *ngIf="personalInfoForm.get('fullName')?.errors?.['required']">Full name is required</span>
              </div>
            </div>
            <div class="form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email" formControlName="email" placeholder="Enter your email" [disabled]="user.isUserVerified">
              <div class="error-message" *ngIf="personalInfoForm.get('email')?.errors && personalInfoForm.get('email')?.touched">
                <span *ngIf="personalInfoForm.get('email')?.errors?.['required']">Email is required</span>
                <span *ngIf="personalInfoForm.get('email')?.errors?.['email']">Please enter a valid email</span>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" formControlName="phone" placeholder="Enter your phone number">
            </div>
            <div class="form-group">
              <label for="location">Location</label>
              <input type="text" id="location" formControlName="location" placeholder="Enter your location">
            </div>
          </div>
          <div class="form-group">
            <label for="bio">About Me</label>
            <textarea id="bio" formControlName="bio" rows="4" placeholder="Tell us about yourself"></textarea>
          </div>
          <div class="form-actions">
            <button type="submit" class="save-btn" [disabled]="personalInfoForm.invalid || personalInfoForm.pristine">Save Changes</button>
          </div>
        </form>
  
        <!-- Organizer Request Button (Only for regular users) -->
        <div *ngIf="user.role === 'USER'" class="organizer-request-section">
          <h3>Become an Event Organizer</h3>
          <p>Want to host and manage your own events? Submit a request to become an organizer.</p>
          <button class="request-organizer-btn" (click)="requestOrganizerRole()" [disabled]="organizerRequestPending">
            <span *ngIf="!organizerRequestPending">Submit Request</span>
            <span *ngIf="organizerRequestPending">Request Pending</span>
          </button>
        </div>
      </div>
  
      <!-- Tickets Tab -->
      <div *ngIf="activeTab === 'tickets'" class="tickets-tab tab-content">
        <h3>My Tickets</h3>
        <div class="tickets-filter">
          <button class="filter-btn" [ngClass]="{'active': ticketFilter === 'all'}" (click)="filterTickets('all')">All</button>
          <button class="filter-btn" [ngClass]="{'active': ticketFilter === 'upcoming'}" (click)="filterTickets('upcoming')">Upcoming</button>
          <button class="filter-btn" [ngClass]="{'active': ticketFilter === 'past'}" (click)="filterTickets('past')">Past</button>
        </div>
        
        <div *ngIf="userTickets.length === 0" class="no-tickets-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="12" rx="2" ry="2"></rect>
            <line x1="2" y1="7" x2="5" y2="7"></line>
            <line x1="2" y1="11" x2="5" y2="11"></line>
            <line x1="19" y1="7" x2="22" y2="7"></line>
            <line x1="19" y1="11" x2="22" y2="11"></line>
            <rect x="8" y="16" width="8" height="4" rx="1" ry="1"></rect>
          </svg>
          <p>You haven't purchased any tickets yet</p>
          <button class="browse-events-btn" (click)="browseEvents()">Browse Events</button>
        </div>
        
        <div class="tickets-grid">
          <div *ngFor="let ticket of filteredTickets" class="ticket-card">
            <div class="ticket-image-wrapper">
              <img [src]="ticket.event.image" [alt]="ticket.event.title" class="ticket-image">
              <div class="ticket-overlay"></div>
              <div class="ticket-date-badge">
                <span class="ticket-day">{{ticket.event.date.split(' ')[0]}}</span>
                <span class="ticket-month">{{ticket.event.date.split(' ')[1].substring(0, 3)}}</span>
              </div>
              <div class="ticket-type-badge">{{ticket.type}}</div>
            </div>
            
            <div class="ticket-content">
              <h4 class="ticket-title">{{ticket.event.title}}</h4>
              <ul class="ticket-details">
                <li class="ticket-detail">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                  <span>{{ticket.event.time}}</span>
                </li>
                <li class="ticket-detail">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                  <span>{{ticket.event.location}}</span>
                </li>
                <li class="ticket-detail">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"></path>
                    <path d="M4 6v12c0 1.1.9 2 2 2h14v-4"></path>
                    <path d="M18 12a2 2 0 0 0 0 4h4v-4z"></path>
                  </svg>
                  <span>{{ticket.purchasePrice}} LKR</span>
                </li>
              </ul>
              
              <div class="ticket-actions">
                <button class="view-ticket-btn" (click)="viewTicket(ticket.id)">View Ticket</button>
                <button class="download-ticket-btn" (click)="downloadTicket(ticket.id)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Bids Tab -->
      <div *ngIf="activeTab === 'bids'" class="bids-tab tab-content">
        <h3>My Bids</h3>
        <div class="bids-filter">
          <button class="filter-btn" [ngClass]="{'active': bidFilter === 'all'}" (click)="filterBids('all')">All</button>
          <button class="filter-btn" [ngClass]="{'active': bidFilter === 'active'}" (click)="filterBids('active')">Active</button>
          <button class="filter-btn" [ngClass]="{'active': bidFilter === 'won'}" (click)="filterBids('won')">Won</button>
          <button class="filter-btn" [ngClass]="{'active': bidFilter === 'lost'}" (click)="filterBids('lost')">Lost</button>
        </div>
        
        <div *ngIf="userBids.length === 0" class="no-bids-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline>
            <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
          </svg>
          <p>You haven't placed any bids yet</p>
          <button class="browse-auctions-btn" (click)="browseAuctions()">Browse Auctions</button>
        </div>
        
        <div class="bids-table-container">
          <table class="bids-table" *ngIf="filteredBids.length > 0">
            <thead>
              <tr>
                <th>Event</th>
                <th>Ticket Type</th>
                <th>Your Bid</th>
                <th>Highest Bid</th>
                <th>End Time</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let bid of filteredBids" [ngClass]="{'winning-bid': bid.status === 'WON'}">
                <td>{{bid.event.title}}</td>
                <td>{{bid.ticketType}}</td>
                <td>{{bid.bidAmount}} LKR</td>
                <td>{{bid.highestBid}} LKR</td>
                <td>{{bid.endTime | date:'medium'}}</td>
                <td>
                  <span class="bid-status" [ngClass]="{
                    'status-active': bid.status === 'ACTIVE',
                    'status-won': bid.status === 'WON',
                    'status-lost': bid.status === 'LOST'
                  }">{{bid.status}}</span>
                </td>
                <td>
                  <button *ngIf="bid.status === 'ACTIVE'" class="update-bid-btn" (click)="openUpdateBidDialog(bid)">Update Bid</button>
                  <button *ngIf="bid.status === 'WON'" class="pay-bid-btn" (click)="payForWonBid(bid)">Pay Now</button>
                  <span *ngIf="bid.status === 'LOST'">-</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Security Tab -->
      <div *ngIf="activeTab === 'security'" class="security-tab tab-content">
        <h3>Security Settings</h3>
        
        <div class="security-section">
          <h4>Change Password</h4>
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
            <div class="form-group">
              <label for="currentPassword">Current Password</label>
              <input type="password" id="currentPassword" formControlName="currentPassword" placeholder="Enter your current password">
              <div class="error-message" *ngIf="passwordForm.get('currentPassword')?.errors && passwordForm.get('currentPassword')?.touched">
                <span *ngIf="passwordForm.get('currentPassword')?.errors?.['required']">Current password is required</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="newPassword">New Password</label>
              <input type="password" id="newPassword" formControlName="newPassword" placeholder="Enter your new password" (input)="checkPasswordStrength()">
              <div class="password-strength">
                <div class="strength-bar" [ngClass]="strengthClass(0)"></div>
                <div class="strength-bar" [ngClass]="strengthClass(1)"></div>
                <div class="strength-bar" [ngClass]="strengthClass(2)"></div>
                <div class="strength-bar" [ngClass]="strengthClass(3)"></div>
              </div>
              <div class="strength-text" [ngStyle]="{'color': strengthColor}">
                Password strength: {{strengthText}}
              </div>
              <div class="error-message" *ngIf="passwordForm.get('newPassword')?.errors && passwordForm.get('newPassword')?.touched">
                <span *ngIf="passwordForm.get('newPassword')?.errors?.['required']">New password is required</span>
                <span *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 8 characters</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="confirmPassword">Confirm New Password</label>
              <input type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="Confirm your new password">
              <div class="error-message" *ngIf="passwordForm.get('confirmPassword')?.errors && passwordForm.get('confirmPassword')?.touched">
                <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</span>
                <span *ngIf="passwordForm.get('confirmPassword')?.errors?.['mustMatch']">Passwords do not match</span>
              </div>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="change-password-btn" [disabled]="passwordForm.invalid">Update Password</button>
            </div>
          </form>
        </div>
        
        <div class="security-section">
          <h4>Two-Factor Authentication</h4>
          <div class="two-factor-toggle">
            <label class="switch">
              <input type="checkbox" [checked]="user.twoFactorEnabled" (change)="toggleTwoFactor()">
              <span class="slider round"></span>
            </label>
            <span>{{user.twoFactorEnabled ? 'Enabled' : 'Disabled'}}</span>
          </div>
          <p class="security-description">Two-factor authentication adds an extra layer of security to your account by requiring a verification code in addition to your password when you log in.</p>
        </div>
        
        <div class="security-section">
          <h4>Login Activity</h4>
          <table class="login-activity-table">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Device</th>
                <th>IP Address</th>
                <th>Location</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let activity of loginActivities">
                <td>{{activity.timestamp | date:'medium'}}</td>
                <td>{{activity.device}}</td>
                <td>{{activity.ipAddress}}</td>
                <td>{{activity.location}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Organizer Dashboard Tab -->
      <div *ngIf="activeTab === 'dashboard' && user.role === 'ORGANIZER'" class="dashboard-tab tab-content">
        <h3>Organizer Dashboard</h3>
        
        <div class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-icon event-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <p>You haven't created any events yet</p>
          <button class="create-first-event-btn" (click)="openCreateEventModal()">Create Your First Event</button>
        </div>
        
        <div class="events-table-container">
          <table class="events-table" *ngIf="filteredEvents.length > 0">
            <thead>
              <tr>
                <th>Event</th>
                <th>Date</th>
                <th>Location</th>
                <th>Tickets Sold</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let event of filteredEvents">
                <td class="event-cell">
                  <img [src]="event.image" [alt]="event.title" class="event-thumbnail">
                  <span>{{event.title}}</span>
                </td>
                <td>{{event.date}}</td>
                <td>{{event.location}}</td>
                <td>{{event.ticketsSold}}/{{event.totalTickets}}</td>
                <td>
                  <span class="event-status" [ngClass]="{
                    'status-active': event.status === 'ACTIVE',
                    'status-past': event.status === 'PAST',
                    'status-draft': event.status === 'DRAFT',
                    'status-pending': event.status === 'PENDING'
                  }">{{event.status}}</span>
                </td>
                <td class="action-cell">
                  <button class="edit-event-btn" (click)="editEvent(event.id)" *ngIf="event.status !== 'PAST'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                  </button>
                  <button class="view-event-btn" (click)="viewEventDetails(event.id)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                  <button class="manage-tickets-btn" (click)="manageEventTickets(event.id)" *ngIf="event.status === 'ACTIVE'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="5" width="18" height="14" rx="2"></rect>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Admin User Requests Tab -->
      <div *ngIf="activeTab === 'requests' && user.role === 'ADMIN'" class="requests-tab tab-content">
        <h3>User Requests</h3>
        
        <div class="requests-filter">
          <button class="filter-btn" [ngClass]="{'active': requestFilter === 'all'}" (click)="filterRequests('all')">All</button>
          <button class="filter-btn" [ngClass]="{'active': requestFilter === 'pending'}" (click)="filterRequests('pending')">Pending</button>
          <button class="filter-btn" [ngClass]="{'active': requestFilter === 'approved'}" (click)="filterRequests('approved')">Approved</button>
          <button class="filter-btn" [ngClass]="{'active': requestFilter === 'rejected'}" (click)="filterRequests('rejected')">Rejected</button>
        </div>
        
        <div *ngIf="organizerRequests.length === 0" class="no-requests-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <p>No organizer requests to display</p>
        </div>
        
        <div class="requests-table-container">
          <table class="requests-table" *ngIf="filteredRequests.length > 0">
            <thead>
              <tr>
                <th>User</th>
                <th>Email</th>
                <th>Request Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of filteredRequests">
                <td class="user-cell">
                  <img [src]="request.user.profilePicture || 'assets/images/default-avatar.png'" [alt]="request.user.fullName" class="user-avatar">
                  <span>{{request.user.fullName}}</span>
                </td>
                <td>{{request.user.email}}</td>
                <td>{{request.requestDate | date:'medium'}}</td>
                <td>
                  <span class="request-status" [ngClass]="{
                    'status-pending': request.status === 'PENDING',
                    'status-approved': request.status === 'APPROVED',
                    'status-rejected': request.status === 'REJECTED'
                  }">{{request.status}}</span>
                </td>
                <td class="action-cell">
                  <button class="approve-btn" (click)="approveOrganizerRequest(request.id)" *ngIf="request.status === 'PENDING'">Approve</button>
                  <button class="reject-btn" (click)="rejectOrganizerRequest(request.id)" *ngIf="request.status === 'PENDING'">Reject</button>
                  <button class="view-user-btn" (click)="viewUserProfile(request.user.id)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Admin Ticket Reviews Tab -->
      <div *ngIf="activeTab === 'tickets-review' && user.role === 'ADMIN'" class="tickets-review-tab tab-content">
        <h3>Tickets Pending Review</h3>
        
        <div class="tickets-review-filter">
          <button class="filter-btn" [ngClass]="{'active': ticketReviewFilter === 'all'}" (click)="filterTicketReviews('all')">All</button>
          <button class="filter-btn" [ngClass]="{'active': ticketReviewFilter === 'pending'}" (click)="filterTicketReviews('pending')">Pending</button>
          <button class="filter-btn" [ngClass]="{'active': ticketReviewFilter === 'approved'}" (click)="filterTicketReviews('approved')">Approved</button>
          <button class="filter-btn" [ngClass]="{'active': ticketReviewFilter === 'rejected'}" (click)="filterTicketReviews('rejected')">Rejected</button>
        </div>
        
        <div *ngIf="ticketReviews.length === 0" class="no-reviews-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
          <p>No ticket requests to review</p>
        </div>
        
        <div class="tickets-review-list">
          <div *ngFor="let review of filteredTicketReviews" class="ticket-review-card">
            <div class="review-header">
              <h4>{{review.event.title}}</h4>
              <span class="review-status" [ngClass]="{
                'status-pending': review.status === 'PENDING',
                'status-approved': review.status === 'APPROVED',
                'status-rejected': review.status === 'REJECTED'
              }">{{review.status}}</span>
            </div>
            
            <div class="review-content">
              <div class="review-details">
                <div class="organizer-info">
                  <img [src]="review.organizer.profilePicture || 'assets/images/default-avatar.png'" [alt]="review.organizer.fullName" class="organizer-avatar">
                  <div>
                    <h5>Organizer</h5>
                    <p>{{review.organizer.fullName}}</p>
                  </div>
                </div>
                
                <div class="event-time">
                  <h5>Event Date & Time</h5>
                  <p>{{review.event.date}} at {{review.event.time}}</p>
                </div>
                
                <div class="event-location">
                  <h5>Location</h5>
                  <p>{{review.event.location}}</p>
                </div>
                
                <div class="ticket-types">
                  <h5>Ticket Types</h5>
                  <ul>
                    <li *ngFor="let ticket of review.tickets">
                      <strong>{{ticket.type}}:</strong> {{ticket.price}} LKR ({{ticket.quantity}} tickets)
                    </li>
                  </ul>
                </div>
              </div>
              
              <div class="event-image-container">
                <img [src]="review.event.image" [alt]="review.event.title" class="event-preview-image">
              </div>
            </div>
            
            <div class="review-description">
              <h5>Event Description</h5>
              <p>{{review.event.description}}</p>
            </div>
            
            <div class="review-actions" *ngIf="review.status === 'PENDING'">
              <button class="approve-btn" (click)="approveTicket(review.id)">Approve Ticket</button>
              <button class="reject-btn" (click)="openRejectReasonDialog(review.id)">Reject</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Email Verification Modal -->
  <div class="popup-overlay" [ngClass]="{'show': showEmailVerificationModal}" (click)="closeOverlayOnOutsideClick($event)">
    <div class="popup-container">
      <div class="popup-header">
        <h2>Verify Your Email</h2>
        <button type="button" class="close-btn" (click)="closeEmailVerificationModal()">
          <img width="20" height="20" src="https://img.icons8.com/fluency/48/delete-sign.png" alt="delete-sign"/>
        </button>
      </div>
      <div class="popup-body">
        <div class="verification-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4285F4" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <p>We've sent a verification code to <strong>{{user.email}}</strong>. Please enter the code below to verify your email address.</p>
        </div>
        
        <form [formGroup]="verificationForm" (ngSubmit)="verifyEmail()">
          <div class="form-group verification-code-group">
            <label for="verificationCode">Verification Code</label>
            <input type="text" id="verificationCode" formControlName="verificationCode" placeholder="Enter 6-digit code" maxlength="6">
            <div class="error-message" *ngIf="verificationForm.get('verificationCode')?.errors && verificationForm.get('verificationCode')?.touched">
              <span *ngIf="verificationForm.get('verificationCode')?.errors?.['required']">Verification code is required</span>
              <span *ngIf="verificationForm.get('verificationCode')?.errors?.['pattern']">Code must be 6 digits</span>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="verify-btn" [disabled]="verificationForm.invalid">Verify Email</button>
          </div>
        </form>
        
        <div class="resend-code">
          <p>Didn't receive the code? <button class="resend-btn" (click)="resendVerificationCode()" [disabled]="resendCooldown > 0">
            <span *ngIf="resendCooldown === 0">Resend Code</span>
            <span *ngIf="resendCooldown > 0">Resend in {{resendCooldown}}s</span>
          </button></p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Update Bid Modal -->
  <div class="popup-overlay" [ngClass]="{'show': showUpdateBidModal}" (click)="closeOverlayOnOutsideClick($event)">
    <div class="popup-container">
      <div class="popup-header">
        <h2>Update Your Bid</h2>
        <button type="button" class="close-btn" (click)="closeUpdateBidModal()">
          <img width="20" height="20" src="https://img.icons8.com/fluency/48/delete-sign.png" alt="delete-sign"/>
        </button>
      </div>
      <div class="popup-body">
        <div class="bid-details" *ngIf="selectedBid">
          <h3>{{selectedBid.event.title}}</h3>
          <p class="ticket-type">{{selectedBid.ticketType}} Ticket</p>
          
          <div class="bid-info">
            <div class="current-bid">
              <p>Your Current Bid</p>
              <h4>{{selectedBid.bidAmount}} LKR</h4>
            </div>
            <div class="highest-bid">
              <p>Highest Bid</p>
              <h4>{{selectedBid.highestBid}} LKR</h4>
            </div>
          </div>
          
          <form [formGroup]="updateBidForm" (ngSubmit)="submitBidUpdate()">
            <div class="form-group">
              <label for="newBidAmount">New Bid Amount (LKR)</label>
              <input type="number" id="newBidAmount" formControlName="newBidAmount" min="{{selectedBid.highestBid + 100}}" step="100">
              <div class="error-message" *ngIf="updateBidForm.get('newBidAmount')?.errors && updateBidForm.get('newBidAmount')?.touched">
                <span *ngIf="updateBidForm.get('newBidAmount')?.errors?.['required']">Please enter a bid amount</span>
                <span *ngIf="updateBidForm.get('newBidAmount')?.errors?.['min']">Your bid must be higher than the current highest bid</span>
              </div>
            </div>
            
            <div class="min-bid-note">
              <p>Minimum bid increment: 100 LKR</p>
            </div>
            
            <div class="form-actions">
              <button type="submit" class="update-bid-btn" [disabled]="updateBidForm.invalid">Update Bid</button>
            </div>
          </form>
          
          <div class="auction-ends">
            <p>Auction ends in: <strong>{{auctionTimeRemaining}}</strong></p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Create Event Modal -->
  <div class="popup-overlay" [ngClass]="{'show': showCreateEventModal}" (click)="closeOverlayOnOutsideClick($event)">
    <div class="popup-container event-popup-container">
      <div class="popup-header">
        <h2>Create New Event</h2>
        <button type="button" class="close-btn" (click)="closeCreateEventModal()">
          <img width="20" height="20" src="https://img.icons8.com/fluency/48/delete-sign.png" alt="delete-sign"/>
        </button>
      </div>
      <div class="popup-body">
        <form [formGroup]="eventForm" (ngSubmit)="submitEvent()">
          <div class="form-section">
            <h3>Event Details</h3>
            
            <div class="form-group">
              <label for="eventTitle">Event Title</label>
              <input type="text" id="eventTitle" formControlName="title" placeholder="Enter event title">
              <div class="error-message" *ngIf="eventForm.get('title')?.errors && eventForm.get('title')?.touched">
                <span *ngIf="eventForm.get('title')?.errors?.['required']">Event title is required</span>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="eventDate">Event Date</label>
                <input type="date" id="eventDate" formControlName="date">
                <div class="error-message" *ngIf="eventForm.get('date')?.errors && eventForm.get('date')?.touched">
                  <span *ngIf="eventForm.get('date')?.errors?.['required']">Event date is required</span>
                </div>
              </div>
              
              <div class="form-group">
                <label for="eventTime">Event Time</label>
                <input type="time" id="eventTime" formControlName="time">
                <div class="error-message" *ngIf="eventForm.get('time')?.errors && eventForm.get('time')?.touched">
                  <span *ngIf="eventForm.get('time')?.errors?.['required']">Event time is required</span>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="eventLocation">Event Location</label>
              <input type="text" id="eventLocation" formControlName="location" placeholder="Enter event venue/location">
              <div class="error-message" *ngIf="eventForm.get('location')?.errors && eventForm.get('location')?.touched">
                <span *ngIf="eventForm.get('location')?.errors?.['required']">Event location is required</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="eventType">Event Type</label>
              <select id="eventType" formControlName="type">
                <option value="">Select event type</option>
                <option value="CONCERT">Concert</option>
                <option value="THEATER">Theater</option>
                <option value="SPORTS">Sports</option>
                <option value="CONFERENCE">Conference</option>
                <option value="EXHIBITION">Exhibition</option>
                <option value="WORKSHOP">Workshop</option>
                <option value="OTHER">Other</option>
              </select>
              <div class="error-message" *ngIf="eventForm.get('type')?.errors && eventForm.get('type')?.touched">
                <span *ngIf="eventForm.get('type')?.errors?.['required']">Event type is required</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="eventDescription">Event Description</label>
              <textarea id="eventDescription" formControlName="description" rows="4" placeholder="Describe your event"></textarea>
              <div class="error-message" *ngIf="eventForm.get('description')?.errors && eventForm.get('description')?.touched">
                <span *ngIf="eventForm.get('description')?.errors?.['required']">Event description is required</span>
              </div>
            </div>
            
            <div class="form-group">
              <label for="eventImage">Event Image</label>
              <div class="image-upload-container">
                <div class="image-preview" *ngIf="eventImagePreview">
                  <img [src]="eventImagePreview" alt="Event image preview">
                  <button type="button" class="remove-image-btn" (click)="removeEventImage()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                <label for="eventImageInput" class="image-upload-btn" *ngIf="!eventImagePreview">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                  <span>Upload Event Image</span>
                </label>
                <input type="file" id="eventImageInput" accept="image/*" (change)="onEventImageSelected($event)" style="display: none">
              </div>
              <div class="error-message" *ngIf="eventForm.get('image')?.errors && eventForm.get('image')?.touched">
                <span *ngIf="eventForm.get('image')?.errors?.['required']">Event image is required</span>
              </div>
            </div>
          </div>
          
          <div class="form-section">
            <h3>Ticket Information</h3>
            
            <div formArrayName="tickets">
              <div *ngFor="let ticket of ticketsFormArray.controls; let i = index" [formGroupName]="i" class="ticket-form-group">
                <div class="ticket-header">
                  <h4>Ticket Type {{i + 1}}</h4>
                  <button type="button" class="remove-ticket-btn" *ngIf="ticketsFormArray.length > 1" (click)="removeTicket(i)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label [for]="'ticketType' + i">Ticket Name</label>
                    <input type="text" [id]="'ticketType' + i" formControlName="type" placeholder="e.g. Regular, VIP, Premium">
                    <div class="error-message" *ngIf="ticket.get('type')?.errors && ticket.get('type')?.touched">
                      <span *ngIf="ticket.get('type')?.errors?.['required']">Ticket name is required</span>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label [for]="'ticketPrice' + i">Price (LKR)</label>
                    <input type="number" [id]="'ticketPrice' + i" formControlName="price" min="0" step="100">
                    <div class="error-message" *ngIf="ticket.get('price')?.errors && ticket.get('price')?.touched">
                      <span *ngIf="ticket.get('price')?.errors?.['required']">Ticket price is required</span>
                      <span *ngIf="ticket.get('price')?.errors?.['min']">Price must be greater than or equal to 0</span>
                    </div>
                  </div>
                </div>
                
                <div class="form-row">
                  <div class="form-group">
                    <label [for]="'ticketQuantity' + i">Quantity</label>
                    <input type="number" [id]="'ticketQuantity' + i" formControlName="quantity" min="1">
                    <div class="error-message" *ngIf="ticket.get('quantity')?.errors && ticket.get('quantity')?.touched">
                      <span *ngIf="ticket.get('quantity')?.errors?.['required']">Ticket quantity is required</span>
                      <span *ngIf="ticket.get('quantity')?.errors?.['min']">Quantity must be at least 1</span>
                    </div>
                  </div>
                  
                  <div class="form-group bidding-toggle">
                    <label>Enable Bidding</label>
                    <div class="toggle-container">
                      <label class="switch">
                        <input type="checkbox" formControlName="enableBidding">
                        <span class="slider round"></span>
                      </label>
                      <span class="toggle-label">{{ticket.get('enableBidding')?.value ? 'Yes' : 'No'}}</span>
                    </div>
                  </div>
                </div>
                
                <div class="form-group" *ngIf="ticket.get('enableBidding')?.value">
                  <label [for]="'minBidPrice' + i">Minimum Bid Price (LKR)</label>
                  <input type="number" [id]="'minBidPrice' + i" formControlName="minBidPrice" min="0" step="100">
                  <div class="error-message" *ngIf="ticket.get('minBidPrice')?.errors && ticket.get('minBidPrice')?.touched">
                    <span *ngIf="ticket.get('minBidPrice')?.errors?.['required']">Minimum bid price is required when bidding is enabled</span>
                  </div>
                </div>
                
                <div class="ticket-description">
                  <label [for]="'ticketDescription' + i">Description (Optional)</label>
                  <textarea [id]="'ticketDescription' + i" formControlName="description" rows="2" placeholder="Describe what's included with this ticket"></textarea>
                </div>
              </div>
            </div>
            
            <button type="button" class="add-ticket-btn" (click)="addTicket()">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
              Add Another Ticket Type
            </button>
          </div>
          
          <div class="form-actions">
            <button type="button" class="save-draft-btn" (click)="saveEventAsDraft()">Save as Draft</button>
            <button type="submit" class="submit-event-btn">Submit for Review</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Reject Reason Modal -->
  <div class="popup-overlay" [ngClass]="{'show': showRejectReasonModal}" (click)="closeOverlayOnOutsideClick($event)">
    <div class="popup-container">
      <div class="popup-header">
        <h2>Provide Rejection Reason</h2>
        <button type="button" class="close-btn" (click)="closeRejectReasonModal()">
          <img width="20" height="20" src="https://img.icons8.com/fluency/48/delete-sign.png" alt="delete-sign"/>
        </button>
      </div>
      <div class="popup-body">
        <form [formGroup]="rejectReasonForm" (ngSubmit)="submitRejectReason()">
          <div class="form-group">
            <label for="rejectReason">Reason for Rejection</label>
            <textarea id="rejectReason" formControlName="reason" rows="4" placeholder="Provide detailed feedback to the organizer"></textarea>
            <div class="error-message" *ngIf="rejectReasonForm.get('reason')?.errors && rejectReasonForm.get('reason')?.touched">
              <span *ngIf="rejectReasonForm.get('reason')?.errors?.['required']">Rejection reason is required</span>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="reject-btn" [disabled]="rejectReasonForm.invalid">Submit Rejection</button>
          </div>
        </form>
      </div>
    </div>
  </div>="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Total Events</h4>
              <p class="stat-value">{{organizerStats.totalEvents}}</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon ticket-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline>
                <path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Tickets Sold</h4>
              <p class="stat-value">{{organizerStats.ticketsSold}}</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon revenue-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Total Revenue</h4>
              <p class="stat-value">{{organizerStats.totalRevenue}} LKR</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon bid-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="23 7 23 1 17 1"></polyline>
                <line x1="16" y1="8" x2="23" y2="1"></line>
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
              </svg>
            </div>
            <div class="stat-content">
              <h4>Active Bids</h4>
              <p class="stat-value">{{organizerStats.activeBids}}</p>
            </div>
          </div>
        </div>
        
        <div class="sales-chart-container">
          <h4>Ticket Sales Trend</h4>
          <div class="sales-chart">
            <!-- Chart would be rendered here using a chart library -->
            <p class="chart-placeholder">Sales trend visualization would appear here</p>
          </div>
        </div>
        
        <div class="recent-sales">
          <h4>Recent Sales</h4>
          <table class="recent-sales-table">
            <thead>
              <tr>
                <th>Event</th>
                <th>Ticket Type</th>
                <th>Purchase Date</th>
                <th>Customer</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let sale of recentSales">
                <td>{{sale.eventTitle}}</td>
                <td>{{sale.ticketType}}</td>
                <td>{{sale.purchaseDate | date:'medium'}}</td>
                <td>{{sale.customerName}}</td>
                <td>{{sale.price}} LKR</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Organizer Events Tab -->
      <div *ngIf="activeTab === 'events' && user.role === 'ORGANIZER'" class="events-tab tab-content">
        <div class="events-header">
          <h3>My Events</h3>
          <button class="create-event-btn" (click)="openCreateEventModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Create Event
          </button>
        </div>
        
        <div class="events-filter">
          <button class="filter-btn" [ngClass]="{'active': eventFilter === 'all'}" (click)="filterEvents('all')">All</button>
          <button class="filter-btn" [ngClass]="{'active': eventFilter === 'active'}" (click)="filterEvents('active')">Active</button>
          <button class="filter-btn" [ngClass]="{'active': eventFilter === 'past'}" (click)="filterEvents('past')">Past</button>
          <button class="filter-btn" [ngClass]="{'active': eventFilter === 'draft'}" (click)="filterEvents('draft')">Draft</button>
          <button class="filter-btn" [ngClass]="{'active': eventFilter === 'pending'}" (click)="filterEvents('pending')">Pending Approval</button>
        </div>
        
        <div *ngIf="organizerEvents.length === 0" class="no-events-message">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx